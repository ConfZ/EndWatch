/*
Commit Number: v3.6.0-0-g3a34e44d02c9
URL: https://gitlab.com/wireshark/wireshark/-/issues/17813
Project Name: Wireshark
termination: FALSE
*/




void *
wmem_tree_lookup32_le(wmem_tree_t *tree, guint32 key)
{
    wmem_tree_node_t *node = tree->root;

    while (node) {
        if (key == GPOINTER_TO_UINT(node->key)) {
            return node->data;
        }
        else if (key < GPOINTER_TO_UINT(node->key)) {
            if (node->left == NULL) {
                break;
            }
            node = node->left;
        }
        else if (key > GPOINTER_TO_UINT(node->key)) {
            if (node->right == NULL) {
                break;
            }
            node = node->right;
        }
    }

    if (!node) {
        return NULL;
    }
    if (node->parent == NULL) {
        if (key > GPOINTER_TO_UINT(node->key)) {
            return node->data;
        } else {
            return NULL;
        }
    }

    if (GPOINTER_TO_UINT(node->key) <= key) {
        return node->data;
    }
    else if (node == node->parent->left) {
        while (node) {
            if (key > GPOINTER_TO_UINT(node->key)) {
                return node->data;
            }
            node=node->parent;
        }
        return NULL;
    }
    else {
        return node->parent->data;
    }
}

int main(){
    while (tp && tp->lastseq >= seq) {
        wmem_stack_push(packets, tp);
        if (tp->seq == 0) {
            // reached first segment.
            break;
        }
        tp = (rtmpt_packet_t *)wmem_tree_lookup32_le(rconv->packets[cdir], tp->seq-1);
    }
}